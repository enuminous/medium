<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EFMW / Medium — Index</title>
<style>
  :root { --bg:#0b1020; --card:#121933; --text:#e7ecff; --muted:#9aa7d9; --accent:#6ea8ff; }
  * { box-sizing: border-box; }
  body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
         background: linear-gradient(180deg, var(--bg), #0e1530 60%, #0a0f24);
         color: var(--text); margin: 0; padding: 2rem 1rem; }
  a { color: var(--accent); text-decoration: none; }
  a:hover { text-decoration: underline; }
  .wrap { max-width: 1100px; margin: 0 auto; }
  h1 { margin: 0 0 0.5rem; font-size: clamp(1.4rem, 3.5vw, 2rem); }
  .sub { color: var(--muted); margin-bottom: 1rem; }
  .toolbar { display: grid; grid-template-columns: 1fr auto; gap: .75rem; margin-bottom: 1rem; }
  .search { width: 100%; padding: .75rem .9rem; border-radius: .75rem; border: 1px solid #24305c;
            background: #0c1430; color: var(--text); font-size: 1rem; outline: none; }
  .count { color: var(--muted); font-size: .9rem; text-align: right; align-self: center; }
  .pillbar { display: flex; flex-wrap: wrap; gap: .5rem; margin-bottom: .5rem; }
  .pill { padding: .35rem .6rem; border-radius: 999px; border: 1px solid #24305c; color: var(--muted); cursor: pointer; background: transparent; }
  .pill.active { background: #122052; color: #cfe0ff; border-color: #2f4fa0; }
  .card { background: rgba(18,25,51,.6); border: 1px solid #1c2450; border-radius: .9rem; overflow: hidden; }
  .list { list-style: none; margin: 0; padding: 0; max-height: 70vh; overflow: auto; }
  .list li { border-top: 1px solid rgba(255,255,255,.06); }
  .list li:first-child { border-top: none; }
  .item { display: grid; grid-template-columns: 1fr auto; gap: .5rem; align-items: center; padding: .75rem 1rem; }
  mark { background: #fffd00; color: black; padding: 0 .1em; border-radius: .15rem; }
</style>
</head>
<body>
<div class="wrap">
  <h1>EFMW / Medium — Index</h1>
  <div class="sub">Auto-populated from <code>enuminous/Medium</code> via GitHub Tree API. Links point to <code>/Medium/filename.html</code>.</div>
  <div class="toolbar">
    <input id="q" class="search" placeholder="Search titles… (regex OK, e.g., ^2025-01)" autofocus />
    <div class="count"><span id="cnt">0</span> items</div>
  </div>
  <div class="pillbar" id="alpha"></div>
  <div class="card">
    <ul class="list" id="list"></ul>
  </div>
</div>
<script>
(async function(){
  const owner = 'enuminous';
  const repo  = 'Medium';
  const branch = 'main';
  const API = `https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=1`;

  const res = await fetch(API, { headers: { 'Accept': 'application/vnd.github+json' }});
  if (!res.ok) {
    document.getElementById('list').innerHTML = '<li class="item">Failed to fetch file list: ' + res.status + '</li>';
    return;
  }
  const data = await res.json();
  const files = (data.tree || [])
      .filter(n => n.type === 'blob' && /\.html?$/i.test(n.path))
      .map(n => n.path.replace(/^\.*?\//, ''));

  // Render
  const list = document.getElementById('list');
  const q = document.getElementById('q');
  const cnt = document.getElementById('cnt');

  // BASE: always capital M per requirement
  const BASE = '/Medium/';

  const rows = files.sort((a,b)=>a.localeCompare(b, undefined, {sensitivity:'base'}))
    .map(path => {
      const title = path.replace(/\.html?$/i, '');
      const li = document.createElement('li');
      li.className = 'item';
      li.dataset.title = title;
      li.innerHTML = `<div class="t">${title}</div><a href="${BASE}${encodeURI(path)}">${path}</a>`;
      return li;
    });

  rows.forEach(li => list.appendChild(li));
  const all = Array.from(document.querySelectorAll('#list .item'));
  const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
  const alpha = document.getElementById('alpha');
  function setCount(n){ cnt.textContent = n; }
  function escapeRegExp(s){ return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }
  function highlight(text, term){
    if (!term) return text;
    try{
      const r = new RegExp(term, 'ig');
      return text.replace(r, m => '<mark>'+m+'</mark>');
    } catch(e){
      const r = new RegExp(escapeRegExp(term), 'ig');
      return text.replace(r, m => '<mark>'+m+'</mark>');
    }
  }
  function apply(){
    const term = q.value.trim();
    let visible = 0;
    all.forEach(li => {
      const title = li.dataset.title;
      if (!term){
        li.style.display = '';
        li.querySelector('.t').innerHTML = title;
        visible++;
        return;
      }
      let ok = false;
      try { ok = new RegExp(term, 'i').test(title); }
      catch(e){ ok = title.toLowerCase().includes(term.toLowerCase()); }
      li.style.display = ok ? '' : 'none';
      if (ok){
        li.querySelector('.t').innerHTML = highlight(title, term.startsWith('^') ? term.slice(1) : term);
        visible++;
      }
    });
    setCount(visible);
  }
  q.addEventListener('input', apply);

  // A–Z pills
  const clear = document.createElement('button');
  clear.className = 'pill active'; clear.textContent = 'All';
  clear.onclick = () => { q.value=''; apply(); setActive(clear); };
  alpha.appendChild(clear);
  letters.forEach(L => {
    const pill = document.createElement('button');
    pill.className = 'pill'; pill.textContent = L;
    pill.onclick = () => { q.value = '^' + L; apply(); setActive(pill); };
    alpha.appendChild(pill);
  });
  function setActive(pill){
    document.querySelectorAll('.pill').forEach(p=>p.classList.remove('active'));
    if (pill) pill.classList.add('active');
  }

  // initial count
  setCount(all.length);
})();
</script>
</body>
</html>
